# 期货保证金试算 Web 应用 - 需求文档

## 一、应用概述

一个简洁实用的**黄金期货**保证金计算器，帮助用户计算持仓所需保证金、预结算后可用资金及可新开仓手数。

- **适用品种**：黄金期货（合约乘数固定为 1000 克/手）

## 二、功能规格

### 2.1 用户输入项

| 字段 | 数据类型 | 默认值 | 可编辑 | 校验规则 | 显示格式 |
|------|----------|--------|--------|----------|----------|
| 合约 | 文本 | 空 | ✅ | 无校验 | 4位数字宽度 |
| 预结算价 | 数字 | 空 | ✅ | 非负数 | 6位含小数点宽度 |
| 持仓手数 | 整数 | 空 | ✅ | 非负整数 | 4位数字宽度 |
| 保证金比例 | 百分比 | 空 | ✅ | 非负数 | 2位数字宽度 |
| 当前权益 | 数字 | 空 | ✅ | 非负数 | 千分位分隔符格式 |

### 2.2 自动计算项

| 字段 | 公式 | 说明 |
|------|------|------|
| 按合约所需保证金(万元) | `预结算价 × 1000 × 持仓手数 × 保证金比例 ÷ 10000` | 1000 为黄金期货合约乘数 |
| 预结算总可用资金(万元) | `当前权益 ÷ 10000 - Σ(各合约所需保证金)` | 全局显示，所有合约共用 |
| 最多可新开仓手数 | `(总可用资金 × 10000) ÷ (预结算价 × 1000 × 保证金比例)` | 每行分别显示，不取整 |

### 2.3 界面结构

- 固定3行合约
- 顶部：当前权益输入框（支持千分位格式显示）
- 中部：合约表格（6列：合约、预结算价、持仓手数、保证金比例、所需保证金、可开手数）
  - 输入列宽度：合约 80px、预结算价 110px、持仓手数 80px、保证金比例 58px
  - 结果列：自适应内容宽度
- 底部：
  - 预结算总可用资金显示 + 重置按钮
  - 联系方式提示（18612738921）

### 2.4 输入校验

- **校验对象**：预结算价、持仓手数、保证金比例、当前权益
- **校验规则**：
  - 预结算价、保证金比例、当前权益：非负数
  - 持仓手数：非负整数
- **输入限制**：使用 `type="number" min="0"` 禁止输入负数
- **错误提示**：提示用户"只能输入非负数"

### 2.5 计算结果显示

- **精度**：所有计算结果保留 2 位小数
- **颜色标识**：
  - 正数：绿色显示（#27ae60）
  - 负数：红色显示（#e74c3c）
  - 无效值：灰色显示（#999）
- 无效（如除以0、输入不完整）：显示"--"
- **字体大小**：16px（比输入框字体大一号）

### 2.6 数据持久化

- 使用 localStorage 保存用户输入
- 页面刷新后自动恢复上次输入的数据

### 2.7 重置功能

- 提供"重置"按钮
- 点击后清空所有输入项（包括合约代码、预结算价、持仓手数、保证金比例、当前权益）
- 清空 localStorage 中的保存数据
- 所有字段恢复为空白，需要用户重新输入

## 三、技术方案

| 项目 | 选择 |
|------|------|
| 框架 | 纯 HTML + CSS + JavaScript（单文件） |
| 样式 | 简洁实用风格，响应式布局（适配移动端） |
| 存储 | localStorage |
| 计算 | 实时计算（`oninput` 事件触发，输入变化时立即更新） |
| 输入控件 | `<input type="number" min="0">` 禁止负数输入 |
| PWA 支持 | Service Worker + manifest.json，支持离线使用和添加到主屏幕 |
| 部署方式 | GitHub Pages (HTTPS) |

## 四、特色功能

### 4.1 千分位格式化
- 当前权益输入框支持会计专用千分位分隔符
- 输入时自动移除分隔符，失焦时自动添加
- 示例：输入 1000000 显示为 1,000,000

### 4.2 PWA 移动应用
- 支持添加到 iPhone/Android 主屏幕
- 离线缓存，无网络也可使用
- 自定义应用图标和主题色
- 安装方式：Safari 浏览器 → 分享 → 添加到主屏幕

### 4.3 联系支持
- 页面底部显示联系电话
- 移动端点击电话号码可直接拨打
